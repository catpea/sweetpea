<loop>
  <space>
    <scene>

      <loop children>

        <loop children>
          <new program attributes="id type" when="component=='program'">
          <new cable attributes="from to" when="component=='cable'">
        </loop>

      </loop>

    </scene>
  </space>
</loop>


























<template id="scene">
  <script>
    class Main {
      root;
      constructor({root}){
        this.root = root;
      }
      mount(){
      }
      destroy(){
      }
      say(el){
        console.info('Hello from', el);
      }
    }
  </script>
    <div class="area overflow-hidden" style="min-height: 60vh;">
      <svg class="position-absolute w-100 h-100" xmlns="http://www.w3.org/2000/svg" overflow="visible"></svg>
      <slot></slot>
      <div class="position-absolute btn-toolbar m-3" role="toolbar" aria-label="Toolbar with button groups">
        <div class="btn-group me-2" role="group" aria-label="First group">
          <button type="button" class="btn btn-outline-secondary" onclick="()=>this.root.emit('play');"><i class="bi bi-play"></i></button>
          <button type="button" class="btn btn-outline-secondary" onclick="el=>this.say(el)"><i class="bi bi-arrow-clockwise text-danger" ></i></button>
          <button type="button" class="btn btn-outline-secondary" onclick="console.log(this)"><i class="bi bi-arrow-90deg-down flip-horizontal" ></i></button>
          <button type="button" class="btn btn-outline-secondary" onclick="console.log(this)"><i class="bi bi-arrow-90deg-right"></i></button>
        </div>
        <div class="btn-group me-2" role="group" aria-label="First group">
          <button type="button" class="btn btn-outline-secondary" onclick="console.log(this)"><i class="bi bi-folder2-open"></i></button>
          <button type="button" class="btn btn-outline-secondary" onclick="console.log(this)"><i class="bi bi-floppy"></i></button>
        </div>
      </div>
    </div>
</template>


<template id="fetch">

  <script>
    class Main {

      root;
      data;
      pipe;

      constructor({root, pipe, data}){
        this.root = root;
        this.data = data;
        this.pipe = pipe;
      }

      mount(){
        this.root.on('play', async ()=>{
          console.log('Fetch heard play!!!!!!');
          try {
            const response = await fetch(this.data.url.get());
            if (!response.ok) {
              throw new Error(`Response status: ${response.status}`);
            }
            const data = await response.json();
            this.pipe.emit('out', {data})
          } catch (error) {
            console.error(error.message);
          }
        })
      }

      destroy(){
      }

      say(el){
        console.info('Hello from', el);
      }

    }
  </script>

  <div class="card shadow" use="movable" style="width: 18rem; position: absolute; top: 150px; left: 50px;">
    <div class="card-header drag-handle">
      JSON Fetch
    </div>

    <ul class="list-group list-group-flush">

      <!-- <li class="list-group-item">JSON Data<span id="out11" class="position-absolute p-1 top-50 start-100 translate-middle badge rounded-pill bg-success shadow-sm"><i class="bi bi-broadcast"></i></span></li> -->

      <li class="list-group-item">
        <port id="out" direction="out" icon="lightning">
        <div class="form-floating">
          <input type="text" class="form-control" id="floatingInput" value="data.url">
          <label for="floatingInput">URL</label>
        </div>

      </li>
      <!-- <li class="list-group-item">
        <div class="input-group mb-3">
          <span class="input-group-text" id="basic-addon1">url</span>
          <input type="text" class="form-control" placeholder="file.json" aria-label="File Name" aria-describedby="basic-addon1" value="data.direction">
          <small>direction of port is <span>???</span><bind direction with="span"></small>

        </div>
      </li> -->

      <li class="list-group-item">...</li>
    </ul>


    <!-- <div class="card-body">
      <button type="button" class="btn btn-outline-success {{direction=='in'?'d-none':'d-block'}}">Off</button>
      <button type="button" class="btn btn-outline-secondary {{direction=='out'?'d-none':'d-block'}}">On</button>
    </div> -->


    <div class="card-footer text-wrap">
      <small>Will download data from <span>???</span><bind url with="span"> upon play.</small>
    </div>
  </div>
</template>

<template id="bash">
  <script>
    class Main {
      root;
      data;
      pipe;

      constructor({root, pipe, data}){
        this.root = root;
        this.data = data;
        this.pipe = pipe;
      }

      mount(){
        this.pipe.on('in', packet=>{
          console.log('Bash intercepted a packet', packet);
        })
      }

    }
  </script>
  <div class="card shadow" use="movable" style="width: 18rem; position: absolute; top: 100px; left: 500px">
    <div class="card-header drag-handle">
      Featured
    </div>
    <ul class="list-group list-group-flush">
      <li class="list-group-item">An item <port direction="in" icon="gear" id="in"></li>
      <li class="list-group-item">An item <port direction="in" icon="gear" id="in2"></li>
      <li class="list-group-item">A second item</li>
      <li class="list-group-item">A third item</li>
    </ul>
  </div>
</template>

<template id="port">
  <script>
    class Main {
      root;
      pipe;
      data;

      constructor({root, pipe, data}){
        this.root = root;
        this.data = data;
        this.pipe = pipe;
      }

    }
  </script>
  <span use="connectable" class="port-pad position-absolute p-1 top-50 {{direction=='out'?'start-100':'start-0'}} translate-middle badge rounded-pill bg-success shadow-sm"><i class="bi bi-{{icon}}"></i></span>
  <!-- <span class="port-pad position-absolute p-1 top-50 translate-middle badge rounded-pill bg-success shadow-sm"><i class="bi bi-heart"></i></span> -->
</template>
